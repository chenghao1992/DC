<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>下载玄关健康</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" type="text/css" href="base.css">
    <link rel="stylesheet" href="page.css">
    <script src="jquery.min.js"></script>
</head>
<body>
    <!--<div class="imgWrapper">-->
        <!--<img src="img/bg3.png" alt="">-->
    <!--</div>-->
    <!--<a id="down_btn_and_b" class="btn1 download" href="javascript:void(0)" >下载玄关健康</a>-->
    <!--<div id="tip_win_mask" class="tip-win-mask none"></div>-->
    <!--<div id="tip_win" class="tip-win none">-->
        <!--<div class="inline-block v-l-m">-->
            <!--<p class="ft-s-16 ft-w-b p-b-6">链接打不开？</p>-->
            <!--<p>请点击右上角</p>-->
            <!--<p id="option_and">选择“-->
                <!--<span class="clr-d-red">在浏览器中打开</span>”</p>-->
            <!--<p id="option_ios">选择“-->
                <!--<span class="clr-d-red">在Safari中打开</span>”</p>-->
        <!--</div>-->
        <!--<img class="v-l-m" src="img/goToClick.png" />-->
    <!--</div>-->

    <script type="text/javascript">
        myCallApp()
        function  myCallApp() {
            //唤起APP
            var openUrl = '#',
                    noAppdown = '../appInvite/goDownApp.html';
            var url = location.href;
            var arry = url.split('?');
            console.log(arry);
            var param = arry[1] || '';
            console.log(param);
            //识别设备
            function discernDevice2() {
                var user = navigator.userAgent.toLowerCase();
                var dv = {};
                if (user.match(/MicroMessenger/i) == "micromessenger") {
                    dv.weixin = true;
                }
                if (user.match(/QQ\//i) == "qq/") {
                    dv.qq = true;
                }
                if (user.match(/WeiBo/i) == "weibo") {
                    dv.weibo = true;
                }
                if (user.indexOf('android') != -1) {
                    dv.android = true;
                } else if (user.indexOf('iphone') != -1) {
                    dv.iphone = true;
                } else {
                    dv = null;
                }
                return dv;
            }

            function callApp(type) {
                console.log('执行唤起');

                var openApp = {
                    doc: 'dachenappdoctor://',
                    pat: 'dachenapppatient://',
                    gud: 'dachenappguidedoctor://',
                    nur: 'dachenappnurse://',
                    das: 'dgroupdoctorassistant://'
                }
                if (type == 'doc') {
                    openUrl = openApp.doc + param;

                    iphoneUrl = '../app/downDoctor.html'; //'http://fir.im/xgys';
                    androidUrl = '../app/downDoctor.html'; //'http://fir.im/9kep';
                    noAppdown = noAppdown + '?downTye=doc';

                } else if (type == 'pat') {
                    openUrl = openApp.pat + param;

                    iphoneUrl = '../app/downPatient.html'; //'http://fir.im/xghz';
                    androidUrl = '../app/downPatient.html'; //'http://fir.im/rvg6';
                    noAppdown = noAppdown + '?downTye=pati';

                }


                var timeout, t = 1000,
                        hasApp = true;

                setTimeout(function () {

                    if (hasApp) {
                    }

                    // 如果没有APP
                    else {

                        // 获取访问的设备
                        var device = discernDevice2();

                        //判断设备
                        if (!device)
                            return alert("暂时不支持您的设备");

                        console.info('没有安装app');
//									window.history.back();
                        //一点点拼接页面
                        console.log('加载页面');
                        $('body').html(
                                '<div class="imgWrapper">'+
                                '<img src="img/bg3.png" alt="">'+

                                '</div>'+
                                '<a id="down_btn_and_b"  class="btn1 download" href="javascript:void(0)" >下载玄关健康</a>'+
                                '<div id="tip_win_mask" class="tip-win-mask none"></div>'
                                +'<div id="tip_win" class="tip-win none">'
                                +'<div class="inline-block v-l-m">'+
                                '<p class="ft-s-16 ft-w-b p-b-6">链接打不开？</p>'+
                                '<p>请点击右上角</p>'+
                                '<p id="option_and">选择“'+
                                '<span class="clr-d-red">在浏览器中打开</span>”</p>'+
                                '<p id="option_ios">选择“'+
                                '<span class="clr-d-red">在Safari中打开</span>”</p>'+
                                '</div>'+
                                '<img class="v-l-m" src="img/goToClick.png" />'
                                +'</div>'


                        )

                        loadFunc();

                    }
                }, 5000)

                function testApp() {
                    var t1 = Date.now();
                    var ifr = document.createElement('iframe');
                    ifr.setAttribute('id', 'ifr');
                    ifr.setAttribute('src', openUrl);
                    ifr.style.display = 'none';
                    document.body.appendChild(ifr);
                    window.location.href = openUrl;

                    timeout = setTimeout(function () {
                        try_to_open_app(t1);
                    }, t);
                }

                function try_to_open_app(t1) {
                    var t2 = Date.now();
                    if (!t1 || t2 - t1 < t + 2000) {
                        hasApp = false;
                    }
                }

                testApp();
            }

            callApp('pat');


        }
        function loadFunc() {
            var desc = document.getElementById('desc');
            var downLoad_b = document.getElementById('downLoad_b');
            var protocol = window.protocol || 'http://';

            (function function_name(argument) {
                var device = {},
                        title = document.getElementById('title'),
                        name = document.getElementById('name'),
                        btn_and_a = document.getElementById('down_btn_and_a'),
                        btn_and_b = document.getElementById('down_btn_and_b'),
                        btn_ios_a = document.getElementById('down_btn_ios_a'),
                        btn_ios_b = document.getElementById('down_btn_ios_b'),
                        option_and = document.getElementById('option_and'),
                        option_ios = document.getElementById('option_ios'),
                        tip_win_mask = document.getElementById('tip_win_mask'),
                        tip_win = document.getElementById('tip_win'),
                        and_p_url = protocol+'appdist.mediportal.com.cn/release/patient-release.apk',
                        ios_p_url = 'https://itunes.apple.com/cn/app/xuan-guan-jian-kang/id1092868086?mt=8';

                var agent;
                //识别设备
                function discernDevice() {
                    agent = navigator.userAgent.toLowerCase();
                    if (agent.match(/MicroMessenger/i) == "micromessenger") {
                        device.app = 'weixin'; //在微信中打开
                    } else if (agent.match(/QQ\//i) == "qq/") {
                        device.app = 'qq'; //在QQ打开
                    } else if (agent.match(/WeiBo/i) == "weibo") {
                        device.app = 'weibo'; //在新浪微博客户端打开
                    }

                    if (agent.indexOf('android') != -1) {
                        device.platform = 'Android';
                    } else if (agent.indexOf('iphone') != -1) {
                        device.platform = 'iOS';
                    }
                }

                discernDevice();


                if (device.platform === 'Android') {
                    option_and.setAttribute('class', '');
                    option_ios.setAttribute('class', 'none');

                    btn_and_b.addEventListener('touchstart', initDownLoad);
                } else if (device.platform === 'iOS') {
                    option_and.setAttribute('class', 'none');
                    option_ios.setAttribute('class', '');

                    btn_and_b.addEventListener('touchstart', initDownLoad);
                }

                function initDownLoad() {
                    switch (device.app) {
                        case 'weixin':
                        case 'qq':
                        case 'weibo':
                            tip_win_mask.setAttribute('class', 'tip-win-mask');
                            tip_win.setAttribute('class', 'tip-win');
                            break;
                        default:
                            if (device.platform === 'Android') {
                                location.href = and_p_url;
                                console.log("安卓")
                            } else {
                                location.href = ios_p_url;
                                console.log("苹果")
                            }
                            break;
                    }
                }
            })()
            return; // 微信分享现需要授权，一下代码目前不可用
        }

    </script>

</body>
</html>