"use strict";angular.module("app").service("Group",["$rootScope","$http","utils","modal",function($rootScope,$http,utils,modal){var thiz=this,info={},data={},id=null;utils.localData("curGroupId");$rootScope.doctor={},this.addData=function(d){id=d},this.getData=function(){return info||null};var getAsyncData=function(id,fun){return id?void $http({url:app.url.yiliao.getGroupInfo,cache:!0,data:{access_token:app.url.access_token,id:id},method:"post"}).then(function(resp){1===resp.data.resultCode&&resp.data.data?(data=resp.data.data,thiz.init(data),fun&&fun.call(null,info)):(modal.toast.error("获取集团数据失败！"),console.error("获取集团数据："+resp.data.resultMsg))}):void fun.call(null,info)};return this.init=function(dt){info={id:"666666666666666666666666",name:"",logo:"src/img/logoDefault.jpg",status:{},profit:{},config:{},user:{admin:"admin",headPic:"src/img/a0.jpg"}},dt&&(info.id=dt.id||dt.groupId||info.id,info.name=dt.name||info.name,info.logo=dt.logo||dt.logoUrl||"src/img/logoDefault.jpg",info.status.active=dt.active||info.status.active,info.status.certStatus=dt.certStatus||info.status.certStatus,info.status.applyStatus=dt.applyStatus||info.status.applyStatus,info.creator=dt.creator||info.creator,info.createDate=dt.creatorDate||info.createDate,info.introduction=dt.introduction||info.introduction,info.updator=dt.updator||info.updator,info.updateDate=dt.updatorDate||info.updateDate,info.cureNum=dt.cureNum||info.cureNum,info.companyId=dt.companyId||"",info.standard=dt.standard||"",info.creatorName=dt.creatorName||"",info.user.id=dt.groupUser&&dt.groupUser.doctorId||dt.groupUser&&dt.groupUser.id||"",info.user.name=dt.groupUser&&dt.groupUser.name||"",info.user.admin=dt.groupUser&&dt.groupUser.rootAdmin||info.user.admin,info.user.headPic=dt.groupUser&&dt.groupUser.headPicFileName||dt.groupUser&&dt.groupUser.headPicture||info.user.headPic,info.user.status=dt.userStatus||"1",info.profit.carePlanGroupProfit=dt.config&&dt.config.carePlanGroupProfit||0,info.profit.carePlanParentProfit=dt.config&&dt.config.carePlanParentProfit||0,info.profit.clinicGroupProfit=dt.config&&dt.config.clinicGroupProfit||0,info.profit.clinicParentProfit=dt.config&&dt.config.clinicParentProfit||0,info.profit.phoneGroupProfit=dt.config&&dt.config.phoneGroupProfit||0,info.profit.phoneParentProfit=dt.config&&dt.config.phoneParentProfit||0,info.profit.textGroupProfit=dt.config&&dt.config.textGroupProfit||0,info.profit.textParentProfit=dt.config&&dt.config.textParentProfit||0,info.config.memberApply=dt.config&&dt.config.memberApply||!1,info.config.memberInvite=dt.config&&dt.config.memberInvite||!1,info.config.dutyEndTime=dt.config&&dt.config.dutyEndTime||0,info.config.dutyStartTime=dt.config&&dt.config.dutyStartTime||0,info.config.passByAudit=dt.config&&dt.config.passByAudit||0,info.groupCert=dt.groupCert||info.groupCert,info.isBlocked=dt.skip||info.skip)},this.set=function(key,val){for(var keys=key.split("."),len=keys.length,obj=info,tmp={},n=0;n<len;n++){if(!obj.hasOwnProperty(keys[n])){for(var i=len-1;i>=n;i--)i===n?tmp[keys[i]]=tmp[keys[i]]||val:(tmp[keys[i-1]]={},tmp[keys[i-1]][keys[i]]=tmp[keys[i]]||val);obj[keys[n]]=tmp[keys[n]];break}n===len-1?obj[keys[n]]=val:obj=obj[keys[n]]}},this.get=function(key){for(var keys=key.split("."),len=keys.length,obj=info,n=0;n<len;n++){if(!obj.hasOwnProperty(keys[n]))return;if(n===len-1)return obj[keys[n]];obj=obj[keys[n]]}},this.handle=function(id,fun){getAsyncData(id,fun)},this.update=function(id,fun){getAsyncData(id,fun)},this.getCurrentOrgInfo=function(){for(var _groupList=window.eval(localStorage.getItem("groupList")),_groupList_index=_groupList.length||[];_groupList_index--;)if(localStorage.getItem("curGroupId")==_groupList[_groupList_index].id)return _groupList[_groupList_index];return null},this}]);