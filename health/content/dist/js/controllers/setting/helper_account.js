app.controller("HelperAccountCtrl",function($scope,utils,$http,$modal,toaster,$location,$state,$rootScope,$stateParams,$filter){function getGuiderList(){$http.post(app.url.account.getGuideDoctorList,{access_token:app.url.access_token||localStorage.getItem("check_access_token"),pageIndex:0,pageSize:9999,groupId:localStorage.getItem("curGroupId")}).success(function(data,status,headers,config){1==data.resultCode?(console.log(data.data.pageData),$scope.data=data.data.pageData.map(function(item,index,array){return item.name=item.name?item.name:"导医"+item.userId,item.createTime=$filter("date")(item.createTime,"yyyy-MM-dd HH:mm"),item})):alert(data.resultMsg)}).error(function(data,status,headers,config){alert(data.resultMsg)})}getGuiderList(),$scope.enable=function(item,$event){$event.stopPropagation(),$http.post(app.url.account.updateStatus,{access_token:app.url.access_token,userId:item.userId,flag:1}).success(function(data,status,headers,config){1==data.resultCode?(toaster.pop("success",null,"启用成功"),item.status=1):toaster.pop("error",null,data.resultMsg)}).error(function(data,status,headers,config){toaster.pop("error",null,data.resultMsg)})},$scope.disable=function(item,$event){$event.stopPropagation(),$http.post(app.url.account.updateStatus,{access_token:app.url.access_token,userId:item.userId,flag:5}).success(function(data,status,headers,config){1==data.resultCode?(toaster.pop("success",null,"禁用成功"),item.status=0):toaster.pop("error",null,data.resultMsg)}).error(function(data,status,headers,config){toaster.pop("error",null,data.resultMsg)})},$scope.openAddGuiderModal=function(){var modalInstance=$modal.open({templateUrl:"addGuiderModalContent.html",controller:"addGuiderInstanceCtrl",size:"md"});modalInstance.result.then(function(returnValue){"ok"==returnValue&&getGuiderList()},function(){})},$scope.openGuiderInfoModal=function(item){var modalInstance=$modal.open({templateUrl:"guiderInfoModalContent.html",controller:"guiderInfoInstanceCtrl",size:"md",resolve:{item:function(){return item}}});modalInstance.result.then(function(returnValue){"ok"==returnValue&&getGuiderList()},function(){})}}),app.controller("addGuiderInstanceCtrl",function($scope,$modalInstance,toaster,$http,utils){$scope.addGuiderAccount=function(){return $scope.errorInfo="",$scope.name?$scope.telephone?void $http.post(app.url.account.register,{access_token:app.url.access_token,telephone:$scope.telephone,name:$scope.name,userType:6,loginGroupId:localStorage.getItem("curGroupId")}).success(function(data,status,headers,config){1==data.resultCode?(toaster.pop("success",null,"添加成功"),$modalInstance.close("ok")):toaster.pop("error",null,data.resultMsg)}).error(function(data,status,headers,config){toaster.pop("error",null,data.resultMsg)}):void($scope.errorInfo="手机号码不能为空"):void($scope.errorInfo="用户名不能为空")},$scope.ok=function(){$modalInstance.close("ok")},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}),app.controller("guiderInfoInstanceCtrl",function($scope,$modalInstance,toaster,$http,item){$scope.name=item.name,$scope.telephone=item.telephone,$scope.saveGuiderAccount=function(){return $scope.errorInfo="",$scope.name?$scope.telephone?void $http.post(app.url.account.updateUserInfo,{access_token:app.url.access_token,userId:item.userId,userName:$scope.name,telephone:$scope.telephone}).success(function(data,status,headers,config){1==data.resultCode?(toaster.pop("success",null,"修改成功"),$modalInstance.close("ok")):toaster.pop("error",null,data.resultMsg)}).error(function(data,status,headers,config){toaster.pop("error",null,data.resultMsg)}):void($scope.errorInfo="手机号码不能为空"):void($scope.errorInfo="用户名不能为空")},$scope.resetPassWord=function(){$http.post(app.url.account.resetPassword,{access_token:app.url.access_token,userId:item.userId,telephone:item.telephone}).success(function(data,status,headers,config){1==data.resultCode?(toaster.pop("success",null,"重置成功"),$modalInstance.close("ok")):toaster.pop("error",null,data.resultMsg)}).error(function(data,status,headers,config){toaster.pop("error",null,data.resultMsg)})},$scope.ok=function(){$modalInstance.close("ok")},$scope.cancel=function(){$modalInstance.dismiss("cancel")}});