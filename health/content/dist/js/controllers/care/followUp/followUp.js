"use strict";app.controller("FollowUpCtrl",function($scope,$http,toaster,$modal,$stateParams,EditCareInfoFtory,AddCareRemindFtory,AddMedicationFtory,AddCareCheckRemindFtory,AddLifeQualityFtory,AddSurveyFtory,AddTextFtory,AddCheckDocReplyFtory,AddIllnessTrackFtory,AddArticleFtory){function getPlanData(){$http.post(app.urlRoot+"designer/findCarePlan",{access_token:app.url.access_token,carePlanId:$stateParams.planId}).then(function(rpn){rpn=rpn.data,rpn&&1==rpn.resultCode?$scope.planData=rpn.data:rpn&&rpn.resultMsg?toaster.pop("error",null,rpn.resultMsg):(toaster.pop("error",null,"获取计划数据出错"),console.error(rpn))})}$scope.token=app.url.access_token,$stateParams.planId&&getPlanData(),$scope.getQuestionIndex=function(id,ids){for(var i=0;i<ids.length;i++)if(ids[i]==id)return i;return null},$scope.addSchedulePlan=function(){$scope.planData.schedulePlans.push({dateSeq:function(){return!$scope.planData.schedulePlans||$scope.planData.schedulePlans.length<1?1:$scope.planData.schedulePlans[$scope.planData.schedulePlans.length-1].dateSeq+1}()})},$scope.dateSeqS=function(max,except,pre,next){var _max=max,_min=1;pre&&_min<pre&&(_min=pre);for(var _arry=[],i=_min;i<=_max;i++)_arry.push(i);for(var _dateSeqS=[],k=0;k<$scope.planData.schedulePlans.length;k++)_dateSeqS.push($scope.planData.schedulePlans[k].dateSeq);var _result=[];return _result=_arry.filter(function(item){return item==except||(_dateSeqS.indexOf(item)==-1||void 0)})},$scope.changeSeq=function(schedulePlanId,dateSeq){schedulePlanId&&$http.post(app.urlRoot+"/designer/updateDateSeq",{access_token:app.url.access_token,schedulePlanId:schedulePlanId,dateSeq:dateSeq}).then(function(rpn){rpn=rpn.data,rpn&&1==rpn.resultCode?(toaster.pop("success",null,"设置成功"),getPlanData()):rpn&&rpn.resultMsg?toaster.pop("error",null,rpn.resultMsg):(toaster.pop("error",null,"获取计划数据出错"),console.error(rpn))})},$scope.deleteSchedulePlan=function(schedulePlanId,index){$http.post(app.urlRoot+"designer/deleteSchedulePlan",{access_token:app.url.access_token,schedulePlanId:schedulePlanId}).then(function(rpn){rpn=rpn.data,rpn&&1==rpn.resultCode?(toaster.pop("success",null,"撤消成功"),getPlanData()):rpn&&rpn.resultMsg?toaster.pop("error",null,rpn.resultMsg):(toaster.pop("error",null,"获取计划数据出错"),console.error(rpn))})},$scope.openEdit=function(){function callBack(planData){$scope.planData=planData}var planData={};$scope.planData&&$scope.planData.tmpType?planData=$scope.planData:planData.tmpType=2,EditCareInfoFtory.open(planData,callBack)},$scope.deleteCareItem=function(careItemId){$http.post(app.urlRoot+"designer/deleteCareItem",{access_token:app.url.access_token,careItemId:careItemId}).then(function(rpn){rpn=rpn.data,rpn&&1==rpn.resultCode?(toaster.pop("success",null,"删除成功"),getPlanData()):rpn&&rpn.resultMsg?toaster.pop("error",null,rpn.resultMsg):(toaster.pop("error",null,"获取计划数据出错"),console.error(rpn))})},$scope.addRemind=function(dateSeq,schedulePlanId,remindId,sendTime,content){function callBack(remindData){getPlanData()}var remindData={id:remindId||null,carePlanId:$scope.planData.id||null,dateSeq:dateSeq,sendTime:sendTime||"09:00",schedulePlanId:schedulePlanId||null,tmpType:2,OtherRemind:{content:content||""}};AddCareRemindFtory.open(remindData,callBack)},$scope.addMedication=function(dateSeq,schedulePlanId,medicationId,sendTime,medicalInfos){function callBack(medication){getPlanData()}var medication={id:medicationId||null,carePlanId:$scope.planData.id||null,dateSeq:dateSeq,sendTime:sendTime||"09:00",schedulePlanId:schedulePlanId||null,MedicalCare:{medicalInfos:medicalInfos||[]}};AddMedicationFtory.open(medication,callBack)},$scope.addCheckRemind=function(dateSeq,schedulePlanId,checkId,sendTime,checkItem){function callBack(checkRemind){getPlanData()}var checkData={id:checkId||null,carePlanId:$scope.planData.id||null,dateSeq:dateSeq,sendTime:sendTime||"09:00",schedulePlanId:schedulePlanId||null,checkItem:checkItem||{}};AddCareCheckRemindFtory.open(checkData,callBack)},$scope.addCheckDocReply=function(careItemId,doctorReply){function callBack(checkRemind){getPlanData()}var checkData={careItemId:careItemId,doctorReply:doctorReply};AddCheckDocReplyFtory.open(checkData,callBack)},$scope.addLifeQuality=function(dateSeq,schedulePlanId,lifeScaleId,sendTime,lifeScaleItem){function callBack(lifeQualityData){getPlanData()}var lifeQualityData={id:lifeScaleId||null,carePlanId:$scope.planData.id||null,dateSeq:dateSeq,sendTime:sendTime||"09:00",schedulePlanId:schedulePlanId||null,tmpType:2,lifeScaleItem:lifeScaleItem};AddLifeQualityFtory.open(lifeQualityData,callBack)},$scope.addText=function(dateSeq,schedulePlanId,surveyId,sendTime,surveyItem){function callBack(addTextData){getPlanData()}var addTextData={id:surveyId||null,carePlanId:$scope.planData.id||null,dateSeq:dateSeq,sendTime:sendTime||"09:00",schedulePlanId:schedulePlanId||null,tmpType:1,surveyItem:surveyItem};AddTextFtory.open(addTextData,callBack)},$scope.addSurvey=function(dateSeq,schedulePlanId,surveyId,sendTime,surveyItem){function callBack(surveyData){getPlanData()}var surveyData={id:surveyId||null,carePlanId:$scope.planData.id||null,dateSeq:dateSeq,sendTime:sendTime||"09:00",schedulePlanId:schedulePlanId||null,tmpType:2,surveyItem:surveyItem};AddSurveyFtory.open(surveyData,callBack)},$scope.addIllnessTrack=function(dateSeq,schedulePlanId,lifeScaleId,sendTime,question){function callBack(illnessTrackData){getPlanData()}var illnessTrackData={id:lifeScaleId||null,carePlanId:$scope.planData.id||null,dateSeq:dateSeq,sendTime:sendTime||"09:00",schedulePlanId:schedulePlanId||null};question?(illnessTrackData.question=angular.copy(question),AddIllnessTrackFtory.createIllnessTrack(illnessTrackData,callBack)):AddIllnessTrackFtory.selectBox(illnessTrackData,callBack)},$scope.addTtriggerMsg=function(careItemId,triggerMsgs){function callBack(triggerMsgData){getPlanData()}var triggerMsgData={careItemId:careItemId,triggerMsgs:triggerMsgs||""};AddIllnessTrackFtory.triggerMsg(triggerMsgData,callBack)},$scope.repeatAsk=function(question){function callBack(repeatAskData){getPlanData()}var repeatAskData={question:question};AddIllnessTrackFtory.repeatAsk(repeatAskData,callBack)},$scope.editTips=function(question){function callBack(tipsData){getPlanData()}var tipsData={question:question};AddIllnessTrackFtory.editTips(tipsData,callBack)},$scope.removeIllnessTrackQuestion=function(questionId){$http.post(app.urlRoot+"designer/deleteIllnessTrackQuestion",{access_token:app.url.access_token,questionId:questionId}).then(function(rpn){rpn=rpn.data,rpn&&1==rpn.resultCode?(toaster.pop("success",null,"删除成功"),getPlanData()):rpn&&rpn.resultMsg?toaster.pop("error",null,rpn.resultMsg):(toaster.pop("error",null,"删除出错"),console.error(rpn))})},$scope.moveIllnessTrack=function(careItemId,index,direction){$http.post(app.urlRoot+"designer/moveQuestion",{access_token:app.url.access_token,careItemId:careItemId,location:index,direction:direction}).then(function(rpn){rpn=rpn.data,rpn&&1==rpn.resultCode?(toaster.pop("success",null,"移动成功"),getPlanData()):rpn&&rpn.resultMsg?toaster.pop("error",null,rpn.resultMsg):(toaster.pop("error",null,"移动出错"),console.error(rpn))})},$scope.addArticle=function(dateSeq,schedulePlanId,surveyId,sendTime,articleItem){function callBack(articleData){getPlanData()}var articleData={id:surveyId||null,carePlanId:$scope.planData.id||null,dateSeq:dateSeq,sendTime:sendTime||"09:00",schedulePlanId:schedulePlanId||null,tmpType:2,articleItem:articleItem};AddArticleFtory.open(articleData,callBack)}});