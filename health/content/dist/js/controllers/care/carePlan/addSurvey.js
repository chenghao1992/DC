!function(){function AddSurveyFtory($http,$modal){function openModel(surveyData,callBack){surveyData||(surveyData={});var modalInstance=$modal.open({animation:!0,templateUrl:function(){var isChack=window.location.href.indexOf("/check/");return isChack!=-1?"../src/tpl/care/carePlan/addSurvey.html":"src/tpl/care/carePlan/addSurvey.html"}(),controller:"AddSurveyCtrl",size:"lg",resolve:{surveyData:function(){return surveyData}}});modalInstance.result.then(function(surveyData){callBack&&callBack(surveyData)})}return{open:openModel}}function AddSurveyCtrl($scope,$http,$modal,$modalInstance,toaster,surveyData){function submitsurveyData(data){var param={access_token:app.url.access_token,sendTime:$scope.surveyData.sendTime,carePlanId:$scope.surveyData.carePlanId,schedulePlanId:$scope.surveyData.schedulePlanId,dateSeq:$scope.surveyData.dateSeq,jsonData:JSON.stringify({surveyId:data.surveyId})};$scope.surveyData.id&&(param.id=$scope.surveyData.id),$http.post(app.urlRoot+"designer/saveSurveyItem",param).then(function(rpn){rpn=rpn.data,rpn&&1==rpn.resultCode?(toaster.pop("success",null,"添加成功"),$modalInstance.close(rpn.data)):rpn&&rpn.resultMsg?toaster.pop("error",null,rpn.resultMsg):(toaster.pop("error",null,"获取计划数据出错"),console.error(rpn))})}function setTree(){var contacts=new Tree("lifeQualityLibraryTree",{hasCheck:!1,allCheck:!1,multiple:!1,allHaveArr:!1,self:!0,search:!1,arrType:[1,0],data:{url:app.yiliao+"group/stat/getNewDiseaseTypeTree",param:{access_token:app.url.access_token,groupId:app.url.groupId(),tmpType:6,includePlatform:1}},datakey:{id:"id",name:"name",sub:"children"},info:{name:"name",id:"id",pid:"department",leaf:"leaf"},root:{selectable:!0,name:"全部",id:null},events:{click:treeClick},callback:function(){var dts=contacts.tree.find("dt");dts&&dts.eq(0)&&dts.eq(0).data()&&dts.eq(0).data().info&&treeClick(dts.eq(0).data().info)}})}function treeClick(info){$scope.diseaseName=info.name,setTable(info.id)}function setTable(diseaseTypeId,pageIndex,pageSize){$http.post(app.yiliao+"designer/findSurveysIncludePlatform",{access_token:app.url.access_token,groupId:app.url.groupId(),diseaseTypeId:diseaseTypeId||$scope.diseaseTypeId||"",pageIndex:pageIndex-1||$scope.pageIndex-1||0,pageSize:pageSize||$scope.pageSize||10}).then(function(rpn){rpn=rpn.data,1===rpn.resultCode?($scope.surveyList=rpn.data.pageData,$scope.page_count=rpn.data.total):rpn.resultMsg?toaster.pop("error",null,rpn.resultMsg):toaster.pop("error",null,"接口出错")})}$scope.surveyCheck=function(lifeScaleId,version){var modalInstance=$modal.open({animation:!0,templateUrl:"surveyChickCtrl.html",controller:"ModalSurveyChickCtrl",size:"lg",resolve:{lifeid:function(){return lifeScaleId},version:function(){return version}}});modalInstance.result.then(function(selectedItem){},function(){})},$scope.selectItem={},surveyData&&($scope.selectItem=surveyData.surveyItem,$scope.surveyData=surveyData),$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.ok=function(){return $scope.selectItem.surveyId?void submitsurveyData($scope.selectItem):toaster.pop("error",null,"请选择调查表")},$scope.selectLifeQuality=function(item){$scope.selectItem={surveyId:item.surveyId}},setTimeout(setTree,0),$scope.diseaseTypeId="",$scope.diseaseName="",$scope.pageIndex=1,$scope.pageSize=10,$scope.setTable=setTable,$scope.pageChanged=function(){setTable()}}angular.module("app").factory("AddSurveyFtory",AddSurveyFtory),AddSurveyFtory.$inject=["$http","$modal"],angular.module("app").controller("AddSurveyCtrl",AddSurveyCtrl)}(),app.controller("ModalSurveyChickCtrl",function($scope,$http,$modal,$modalInstance,toaster,lifeid,version){lifeid&&version&&$http.post(app.yiliao+"designer/findSurveyByOne",{access_token:app.url.access_token,surveyId:lifeid,version:version}).then(function(rpn){rpn=rpn.data,1===rpn.resultCode?$scope.surveyData=rpn.data:rpn.resultMsg?toaster.pop("error",null,rpn.resultMsg):toaster.pop("error",null,"接口出错")}),$scope.groupDomId=app.url.groupId(),$scope.cancel=function(){$modalInstance.dismiss("cancel")}});