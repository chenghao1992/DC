!function(){function AddCareCheckRemindFtory($http,$modal){function openModel(chenckData,callBack){chenckData||(chenckData={});var modalInstance=$modal.open({animation:!0,templateUrl:function(){var isChack=window.location.href.indexOf("/check/");return isChack!=-1?"../src/tpl/care/carePlan/addCheckRemind.html":"src/tpl/care/carePlan/addCheckRemind.html"}(),controller:"AddCareCheckRemindCtrl",size:"md",resolve:{chenckData:function(){return chenckData}}});modalInstance.result.then(function(chenckData){callBack&&callBack(chenckData)})}return{open:openModel}}function AddCareCheckRemindCtrl($scope,$http,$modal,$modalInstance,toaster,chenckData){function submitCheckData(data){if(data.checkItem.forwardDays<1)return toaster.pop("error",null,"请输入正确的提前时间");if(!data.checkItem.reminders)return toaster.pop("error",null,"请输入提醒内容");if(data.checkItem.checks.length<1)return toaster.pop("error",null,"请添加检查项");var param={access_token:app.url.access_token,sendTime:data.sendTime,carePlanId:data.carePlanId,schedulePlanId:data.schedulePlanId,dateSeq:data.dateSeq,jsonData:JSON.stringify(data.checkItem)};data.id&&(param.id=data.id),$http.post(app.urlRoot+"designer/saveCheckItem",param).then(function(rpn){rpn=rpn.data,rpn&&1==rpn.resultCode?(toaster.pop("success",null,"添加成功"),$modalInstance.close(rpn.data)):rpn&&rpn.resultMsg?toaster.pop("error",null,rpn.resultMsg):(toaster.pop("error",null,"获取计划数据出错"),console.error(rpn))})}function makeList(arry){for(var i=0;i<arry.length;i++)$scope.$apply(function(){$scope.chenckData.checkItem.checks.push({id:arry[i].id,name:arry[i].name})})}$scope.chenckData=chenckData||{},$scope.chenckData.checkItem={forwardDays:function(){return chenckData&&chenckData.checkItem&&chenckData.checkItem.forwardDays?chenckData.checkItem.forwardDays:1}(),reminders:function(){return chenckData&&chenckData.checkItem&&chenckData.checkItem.reminders?chenckData.checkItem.reminders:""}(),checks:function(){return chenckData&&chenckData.checkItem&&chenckData.checkItem.checks?chenckData.checkItem.checks:[]}()},$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope.ok=function(){submitCheckData($scope.chenckData)},$scope.removePick=function(index){$scope.chenckData.checkItem.checks.splice(index,1)},$scope.pickData=function(){new DataBox("data_res",{hasCheck:!0,allCheck:!0,leafCheck:!1,multiple:!0,allHaveArr:!0,self:!1,cover:!1,selectView:!0,arrType:[0,0,0,0],search:{url:app.urlRoot+"base/searchCheckSuggest",param:{access_token:app.url.access_token,text:"text",pageSize:1e4,pageIndex:0},dataKey:{name:"name",id:"id",union:"parent",dataSet:"data"},keyName:"text",unwind:!1,unLayered:!0},data:{url:app.urlRoot+"base/getCheckSuggest",param:{access_token:app.url.access_token,parentId:0}},async:{url:app.urlRoot+"base/getCheckSuggest",dataKey:{parentId:"id"},data:{access_token:app.url.access_token},dataName:"",target:{data:"",dataKey:{id:"id",name:"name"}}},titles:{main:"添加检查",searchKey:"检查名称",label:"已选择检查"},icons:{arrow:"fa fa-caret-right/fa fa-caret-down",check:"fa fa-check/fa fa-square",root:"fa fa-hospital-o cfblue",branch:"fa fa-h-square cfblue",leaf:"fa fa-user-md dcolor",head:"headPicFileName"},fixdata:[],response:makeList,datakey:{id:"id",name:"name",leaf:"leaf"},info:{name:"name",id:"id"},callback:function(){}})}}angular.module("app").factory("AddCareCheckRemindFtory",AddCareCheckRemindFtory),AddCareCheckRemindFtory.$inject=["$http","$modal"],angular.module("app").controller("AddCareCheckRemindCtrl",AddCareCheckRemindCtrl)}();