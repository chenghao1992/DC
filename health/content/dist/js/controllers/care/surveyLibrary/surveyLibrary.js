"use strict";app.controller("SurveyLibraryCtrl",function($scope,$state,$http,toaster){function treeClick(info){$scope.diseaseName=info.name,setTable(info.id)}function setTable(diseaseTypeId,pageIndex,pageSize){$http.post(app.yiliao+"designer/findSurveys",{access_token:app.url.access_token,groupId:app.url.groupId(),diseaseTypeId:diseaseTypeId||$scope.diseaseTypeId||"",pageIndex:pageIndex-1||$scope.pageIndex-1||0,pageSize:pageSize||$scope.pageSize||10}).then(function(rpn){rpn=rpn.data,1===rpn.resultCode?($scope.surveyList=rpn.data.pageData,$scope.page_count=Math.ceil(rpn.data.total/$scope.pageSize)):rpn.resultMsg?toaster.pop("error",null,rpn.resultMsg):toaster.pop("error",null,"接口出错")})}var contacts=new Tree("sch_cnt_list",{hasCheck:!1,allCheck:!1,multiple:!1,allHaveArr:!1,self:!0,search:!1,arrType:[1,0],data:{url:app.yiliao+"group/stat/getNewDiseaseTypeTree",param:{access_token:app.url.access_token,groupId:app.url.groupId(),tmpType:6}},datakey:{id:"id",name:"name",sub:"children"},info:{name:"name",id:"id",pid:"department",leaf:"leaf"},root:{selectable:!0,name:"全部",id:null},events:{click:treeClick},callback:function(){var dts=contacts.tree.find("dt");treeClick(dts.eq(0).data().info)}});$scope.diseaseTypeId="",$scope.diseaseName="",$scope.pageIndex=1,$scope.pageSize=10,$scope.setTable=setTable,$scope.pageChanged=function(){setTable()},$scope.removeItem=function(surveyId,version){$http.post(app.yiliao+"designer/deleteSurvey",{access_token:app.url.access_token,surveyId:surveyId,version:version}).then(function(rpn){rpn=rpn.data,1===rpn.resultCode?(toaster.pop("success",null,"删除成功"),setTable()):rpn.resultMsg?toaster.pop("error",null,rpn.resultMsg):toaster.pop("error",null,"接口出错")})}});