"use strict";app.controller("CarePlanListCtrl",function($rootScope,$scope,$state,$http,$compile,utils,modal,toaster){function setTable(info){function dataTable(data){datable&&datable.fnClearTable(),datable=$("#planListDatable").dataTable({language:app.lang.datatables.translation,ordering:!1,searching:!1,bDestroy:!0,lengthMenu:[10,15,20,30,40,50,100],data:data,columns:[{data:"careName",defaultContent:"/"},{data:"price",render:function(set,status,dt){return dt.price/100}},{data:null,defaultContent:"<button class='btn btn-xs btn-primary text-xs'>详情</button>"}],createdRow:function(nRow,aData,iDataIndex){$(nRow).on("click","button",function(){console.log(aData.templateId),$state.go("app.edit_plan",{planId:aData.templateId})})}})}$scope.diseaseNameSelected=info.name,$http.post(app.yiliao+"pack/care/queryCareTemplate",{access_token:app.url.access_token,categoryId:info.id,tmpType:1,groupId:app.url.groupId()}).then(function(rpn){1===rpn.data.resultCode?dataTable(rpn.data.data):toaster.pop("error",null,"获取失败")})}console.log(1);var contacts=new Tree("sch_cnt_list",{hasCheck:!1,allCheck:!1,multiple:!1,allHaveArr:!1,self:!0,search:!1,arrType:[1,0],data:{url:app.yiliao+"group/stat/getDiseaseTypeTree",param:{access_token:app.url.access_token,groupId:app.url.groupId(),tmpType:1}},datakey:{id:"id",name:"name",sub:"children"},info:{name:"name",id:"id",pid:"department",leaf:"leaf"},root:{selectable:!0,name:"全部",id:null},events:{click:setTable},callback:function(){var dts=contacts.tree.find("dt");setTable(dts.eq(0).data().info)}}),datable=null;setTable({}),$scope.newPlan=function(){$state.go("app.new_plan")}}),app.controller("CarePlanLibraryCtrl",function($scope,$state,$http,toaster,$modal){function treeClick(info){$scope.diseaseName=info.name,setTable(info.id)}function setTable(diseaseTypeId,pageIndex,pageSize){$http.post(app.urlRoot+"designer/getCarePlans",{access_token:app.url.access_token,groupId:app.url.groupId(),diseaseTypeId:diseaseTypeId||$scope.diseaseTypeId||"",pageIndex:pageIndex-1||$scope.pageIndex-1||0,pageSize:pageSize||$scope.pageSize||10}).then(function(rpn){rpn=rpn.data,1===rpn.resultCode?($scope.planList=rpn.data.pageData,$scope.page_count=rpn.data.total):rpn.resultMsg?toaster.pop("error",null,rpn.resultMsg):toaster.pop("error",null,"接口出错")})}var contacts=new Tree("CarePlanLibraryTree",{hasCheck:!1,allCheck:!1,multiple:!1,allHaveArr:!1,self:!0,search:!1,arrType:[1,0],data:{url:app.yiliao+"group/stat/getDiseaseTypeTree4CareNew",param:{access_token:app.url.access_token,groupId:app.url.groupId()}},datakey:{id:"id",name:"name",sub:"children"},info:{name:"name",id:"id",pid:"department",leaf:"leaf"},root:{selectable:!0,name:"全部",id:null},events:{click:treeClick},callback:function(){var dts=contacts.tree.find("dt");dts&&dts.eq(0)&&dts.eq(0).data()&&dts.eq(0).data().info&&treeClick(dts.eq(0).data().info)}});$scope.diseaseTypeId="",$scope.diseaseName="",$scope.pageIndex=1,$scope.pageSize=10,$scope.setTable=setTable,$scope.pageChanged=function(){setTable()},$scope.enable=function(planId,status){$http.post(app.yiliao+"designer/enable",{access_token:app.url.access_token,carePlanId:planId,status:status}).then(function(rpn){if(rpn=rpn.data,1===rpn.resultCode){var tip="成功禁用";1==status&&(tip="成功启用"),status==-1&&(tip="成功删除"),toaster.pop("success",null,tip),setTable()}else rpn.resultMsg?toaster.pop("error",null,rpn.resultMsg):toaster.pop("error",null,"接口出错")})},$scope.deletePlan=function(planId){var modalInstance=$modal.open({templateUrl:"delModalContent.html",controller:"delModalInstanceCtrl",size:"sm"});modalInstance.result.then(function(status){"ok"==status&&$scope.enable(planId,-1)})}}),app.controller("delModalInstanceCtrl",function($scope,$modalInstance,toaster,$http,utils){$scope.ok=function(){$modalInstance.close("ok")},$scope.cancel=function(){$modalInstance.dismiss("cancel")}});