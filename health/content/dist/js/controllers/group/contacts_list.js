"use strict";app.controller("ContactsList",["$rootScope","$scope","$state","$timeout","$http","utils","Doctor","$stateParams",function($rootScope,$scope,$state,$timeout,$http,utils,Doctor,$stateParams){function initTable(){var index=1,start=0,length=1*utils.localData("page_length")||10,setTable=function(){doctorList=$("#contactsList"),dTable=doctorList.dataTable({draw:index,displayStart:start,lengthMenu:[5,10,15,20,30,40,50,100],pageLength:length,bServerSide:!0,sAjaxSource:url,destroy:!0,fnServerData:function(sSource,aoData,fnCallback){param.groupId=groupId,param.pageIndex=index-1,param.pageSize=aoData[4].value,param.access_token=app.url.access_token,$http({method:"post",url:sSource,data:param}).then(function(resp){resp=resp.data.data;for(var i=0;i<resp.pageData.length;i++)utils.extendHash(resp.pageData[i],["doctor","contactWay","remarks","departmentFullName","applyStatusName","inviterName","updatorDate"]),utils.extendHash(resp.pageData[i].doctor,["name","departments","position","doctorNum","skill","introduction","telephone"]);resp.start=resp.start,resp.recordsTotal=resp.total,resp.recordsFiltered=resp.total,resp.length=resp.pageSize,resp.data=resp.pageData,fnCallback(resp),$scope.loading=!1,$rootScope.loaded=!0})},processing:!0,searching:!1,language:app.lang.datatables.translation,createdRow:function(nRow,aData,iDataIndex){var a_link=$(nRow).find(".a-link");a_link.click(function(){$scope.seeDetails(aData.doctorId)})},columns:[{orderable:!1,render:function(set,status,dt){if(dt.doctor&&dt.doctor.headPicFilePath)var path=dt.doctor.headPicFilePath;else var path="src/img/a0.jpg";return'<img class="a-link" src="'+path+'"/>'},defaultContent:""},{data:"doctor.name",orderable:!1,searchable:!1,render:function(set,status,dt){return'<a class="a-link">'+dt.doctor.name+"</a>"},defaultContent:""},{data:"doctor.doctorNum",orderable:!1,searchable:!1,defaultContent:""},{data:"doctor.position",orderable:!1,searchable:!1,defaultContent:""},{data:"doctor.telephone",orderable:!1,searchable:!1,defaultContent:""},{data:"contactWay",orderable:!1,searchable:!1,defaultContent:""},{data:"applyStatus",orderable:!1,searchable:!1,render:function(set,status,dt){return"1"==set?"已通过":"2"==set?"待审核":"3"==set?"未通过":"7"==set?"未认证":""},defaultContent:""},{data:"inviterName",orderable:!1,searchable:!1,defaultContent:""},{data:"updatorDate",orderable:!1,searchable:!1,render:function(set,status,dt){return set?utils.dateFormat(set,"yyyy年MM月dd日"):""},defaultContent:""},{data:"remarks",orderable:!1,searchable:!1,defaultContent:""}]}),dTable.off().on("init.dt",function(){doctorList.find("tr[data-id="+$rootScope.curRowId+"]").addClass("currentRow")}).on("length.dt",function(e,settings,len){index=1,start=0,length=len,dTable.fnDestroy(),setTable(),utils.localData("page_length",len)}).on("page.dt",function(e,settings){index=settings._iDisplayStart/length+1,start=length*(index-1),dTable.fnDestroy(),utils.localData("page_index",index),utils.localData("page_start",start),setTable()})};setTable()}var url=app.url.yiliao.searchDoctor,groupId=($scope.itemId||utils.localData("itemId"),utils.localData("curGroupId")),curIndex=$stateParams.id.split("/"),param={};$scope.tipType=curIndex[2];var timeStringName=$("#timeStringName");1==curIndex[2]?timeStringName.html("加入时间"):2==curIndex[2]?timeStringName.html("申请时间"):3==curIndex[2]?timeStringName.html("邀请时间"):4==curIndex[2]&&timeStringName.html("离职时间"),0!=curIndex[0]&&("1"==curIndex[1]?param.deptId=curIndex[0]:"2"==curIndex[1]?param.areaId=curIndex[0].split("_"):"3"==curIndex[1]?param.packId=curIndex[0]:"4"==curIndex[1]&&(param.departmentId=curIndex[0],"Undefined"!=curIndex[0]||curIndex[3]?url=app.url.yiliao.getDoctors:(url=app.url.yiliao.getUndistributed,param={}))),"1"!=curIndex[2]&&(param={}),curIndex[3]&&(url=app.url.yiliao.searchDoctor),("Undefined"!=curIndex[0]||curIndex[3])&&(1==curIndex[2]?param.status="C":2==curIndex[2]?param.status="J":3==curIndex[2]?param.status="I":4==curIndex[2]&&(param.status="S")),"4"!=curIndex[1]?"Undefined"!=curIndex[0]||1==curIndex[2]||curIndex[3]||($(".group-mark").removeClass("mark-focus"),param.status=null):(0==curIndex.length||"Undefined"==curIndex[0]&&1!=curIndex[2]&&!curIndex[3])&&($(".group-mark").removeClass("mark-focus"),param.status=null),"Undefined"==curIndex[0]&&"4"!=curIndex[1]&&"1"==curIndex[2]&&(param.status="C"),"list_pass"!==$rootScope.pageName&&(utils.localData("page_index",null),utils.localData("page_start",null),$scope.pageName="list_pass"),$scope.seeDetails=function(id){id&&($("#doctor_details").removeClass("hide"),$rootScope.winVisable=!0,Doctor.addData(id))};var doctorList,dTable;$("#group_search_form");console.log(1212121212),initTable(),$rootScope.initContacsTable=initTable}]);