"use strict";app.controller("RelationshipList",function($rootScope,$scope,$state,$timeout,$http,utils){function initTable(){var name,_index,_start,isSearch=!1,searchTimes=0,index=1*utils.localData("page_index")||1,start=1*utils.localData("page_start")||0,length=1*utils.localData("page_length")||50,setTable=function(){doctorList=$("#relationshipList"),dTable=doctorList.dataTable({draw:index,displayStart:start,lengthMenu:[5,10,15,20,30,40,50,100],pageLength:length,bServerSide:!0,sAjaxSource:url,fnServerData:function(sSource,aoData,fnCallback){$.ajax({type:"post",url:sSource,dataType:"json",data:{name:name,access_token:app.url.access_token,groupId:groupId,parentId:doctorId,pageIndex:index-1,pageSize:aoData[4].value},success:function(resp){for(var i=0;i<resp.data.pageData.length;i++)utils.extendHash(resp.data.pageData[i],["name","groupProfit","parentProfit","contactWay"]);resp.start=resp.data.start,resp.recordsTotal=resp.data.total,resp.recordsFiltered=resp.data.total,resp.length=resp.data.pageSize,resp.data=resp.data.pageData,fnCallback(resp),$scope.loading=!1}})},language:app.lang.datatables.translation,createdRow:function(nRow,aData,iDataIndex){$(nRow).data("x_id",aData.id).attr("data-id",aData.doctorId).click(aData,function(param,e){$rootScope.targetDoctorId=param.data.id,$rootScope.targetDoctorName=param.data.name,$rootScope.groupProfit=param.data.groupProfit||0,$rootScope.superProfit=param.data.parentProfit||0,$scope.seeDetails(param.data.id)})},columns:[{orderable:!1,render:function(set,status,dt){if(dt.headPicFileName)var path=dt.headPicFileName;else var path="src/img/a0.jpg";return'<img src="'+path+'"/>'}},{data:"name",orderable:!1},{data:"groupProfit",orderable:!1,render:function(d){return d.constructor!==Array&&d||(d="0"),d+"%"}},{data:"parentProfit",orderable:!1,render:function(d){return d.constructor!==Array&&d||(d="0"),d+"%"}},{data:"contactWay",orderable:!1,searchable:!1}]}),dTable.off().on("init.dt",function(){doctorList.find("tr[data-id="+$rootScope.curRowId+"]").addClass("currentRow")}).on("length.dt",function(e,settings,len){index=1,start=0,length=len,dTable.fnDestroy(),setTable(),utils.localData("page_length",len)}).on("page.dt",function(e,settings){index=settings._iDisplayStart/length+1,start=length*(index-1),dTable.fnDestroy(),utils.localData("page_index",index),utils.localData("page_start",start),setTable()}).on("search.dt",function(e,settings){settings.oPreviousSearch.sSearch?(isSearch=!0,searchTimes++,_index=settings._iDisplayStart/settings._iDisplayLength+1,_start=settings._iDisplayStart,name=settings.oPreviousSearch.sSearch):(isSearch=!1,name=null),isSearch?(index=1,start=0):searchTimes>0&&(searchTimes=0,index=_index,start=_start,dTable.fnDestroy(),setTable())})};setTable()}var url=app.url.yiliao.getProfitList,doctorId=($("html"),$("body"),$scope.curDoctorId||utils.localData("curDoctorId")),groupId=utils.localData("curGroupId");"list_pass"!==$rootScope.pageName&&(utils.localData("page_index",null),utils.localData("page_start",null),$rootScope.pageName="list_pass"),$scope.seeDetails=function(id){id&&$state.go("app.relationship.list.edit")};var doctorList,dTable;initTable()});