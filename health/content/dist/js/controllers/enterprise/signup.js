"use strict";app.controller("SignupFormController",["$scope","$http","$state","utils",function($scope,$http,$state,utils){function signin(){$http.post(app.url.login,{telephone:$scope.userPhone,password:$scope.userPwd,userType:5}).success(function(data,status,headers,confug){1===data.resultCode?(utils.localData("enterprise_id",data.data.userId),utils.localData("enterprise_userName",data.data.user.name),utils.localData("enterprise_type",data.data.user.userType),utils.localData("enterprise_remember",null),utils.localData("enterprise_telephone",data.data.user.telephone),utils.localData("enterprise_password",null),app.url.access_token=data.data.access_token,utils.localData("access_token",data.data.access_token),utils.localData("company",null),$state.go("access.Fill_Info",{reload:!0})):console.log(data.resultMsg)}).error(function(data,status,headers,config){console.log(data.resultMsg)})}$scope.getSmsBT="获取验证码",$scope.getSmsBTState=!1,$scope.signup=function(){$http.post(app.url.signup,{telephone:$scope.userPhone,password:$scope.userPwd,userType:5}).success(function(data){1===data.resultCode?signin():$scope.authError=data.resultMsg}).error(function(data){$scope.authError=data.resultMsg})},$scope.getSMS=function(){$scope.getSmsBTState=!0,$http.post(app.url.getSMS,{telephone:$scope.userPhone,templateId:25118}).success(function(data,status,headers,confug){if(1===data.resultCode){$scope.getSmsBT=160;var getSms=setInterval(function(){$scope.$apply(function(){$scope.getSmsBT--,0==$scope.getSmsBT&&($scope.getSmsBT="获取验证码",$scope.getSmsBTState=!1,clearInterval(getSms))})},1e3)}else $scope.getSmsBTState=!1,$scope.authError=data.resultMsg})},$scope.$watch("smsCode",function(newValue,oldValue,scope){$scope.smsCodeResult=!1,!$scope.userPhone||!$scope.smsCode||$scope.smsCode.length<4||$http.post(app.url.verifySMS,{telephone:$scope.userPhone,randcode:$scope.smsCode,templateId:25118}).success(function(data,status,headers,confug){1==data.resultCode?$scope.smsCodeResult=!0:$scope.authError=data.resultMsg})})}]);