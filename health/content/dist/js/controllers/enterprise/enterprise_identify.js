"use strict";app.controller("EnterpriseIdentify",["$rootScope","$scope","$http","$timeout","$state","utils","Group","modal",function($rootScope,$scope,$http,$timeout,$state,utils,Group,modal){var userId,groupId=utils.localData("curGroupId");$scope.viewData={},$scope.formData={},$scope.isIdentified=!0,$scope.isIdentifying=!1,Group.handle(groupId,function(group){switch(userId=group.user.id,group.status.certStatus){case"NC":$scope.isIdentified=!1,$scope.isIdentifying=!1;break;case"A":$scope.isIdentified=!0,$scope.isIdentifying=!0,$scope.waitting=!0,$scope.notPass=!1,$scope.pass=!1;break;case"NP":$scope.isIdentified=!0,$scope.isIdentifying=!0,$scope.waitting=!1,$scope.notPass=!0,$scope.pass=!1;break;case"P":$scope.isIdentified=!0,$scope.isIdentifying=!0,$scope.waitting=!1,$scope.notPass=!1,$scope.pass=!0}$scope.isIdentified&&$scope.isIdentifying&&($http({url:app.url.yiliao.getGroupCert,method:"post",data:{access_token:app.url.access_token,groupId:$scope.groupId||utils.localData("curGroupId")}}).then(function(resp){1===resp.data.resultCode?resp.data.data&&resp.data.data.groupCert?($scope.companyName=resp.data.data.groupCert.companyName,$scope.orgCode=resp.data.data.groupCert.orgCode,$scope.license=resp.data.data.groupCert.license,$scope.corporation=resp.data.data.groupCert.corporation,$scope.businessScope=resp.data.data.groupCert.businessScope,$scope.accountName=resp.data.data.groupCert.accountName,$scope.openBank=resp.data.data.groupCert.openBank,$scope.bankAcct=resp.data.data.groupCert.bankAcct,$scope.adminName=resp.data.data.groupCert.adminName,$scope.idNo=resp.data.data.groupCert.idNo,$scope.adminTel=resp.data.data.groupCert.adminTel,$scope.idImage=resp.data.data.groupCert.idImage,$scope.orgCodeImage=resp.data.data.groupCert.orgCodeImage,$scope.licenseImage=resp.data.data.groupCert.licenseImage,$scope.remarks=resp.data.data.groupCert.remarks):modal.toast.warn("未提交认证资料！"):$scope.authError=resp.data.resultMsg},function(resp){$scope.authError=resp.data.resultMsg}),$scope.closeTipWin=function(){$("#btn_close").parents(".idfy-result").remove()})}),$scope.identify=function(){$scope.isIdentified=!1,$scope.isIdentifying=!0},$scope.submitInfo=function(){$http({url:app.url.yiliao.submitCert,method:"post",data:{access_token:app.url.access_token,groupId:groupId||utils.localData("curGroupId"),doctorId:userId||utils.localData("user_id"),companyName:$scope.companyName,orgCode:$scope.orgCode,license:$scope.license,corporation:$scope.corporation,businessScope:$scope.businessScope,accountName:$scope.accountName,openBank:$scope.openBank,bankAcct:$scope.bankAcct,adminName:$scope.adminName,idNo:$scope.idNo,adminTel:$scope.adminTel,idImage:$scope.usrPicUrl,orgCodeImage:$scope.orgCodePicUrl,licenseImage:$scope.licPicUrl}}).then(function(resp){1===resp.data.resultCode?($scope.isIdentifying=!1,$scope.isIdentified=!0,$scope.waitting=!0,$scope.notPass=!1,Group.set("status.certStatus","A"),$state.reload()):$scope.authError=resp.data.resultMsg},function(resp){$scope.authError=resp.data.resultMsg})};var progress,imgURL;$scope.selectFile=function(model){$scope.upload(),progress=model+"Progress",imgURL=model+"Url"},$scope.token=app.url.access_token,$scope.uploaderAdded=function(up,files){$scope.uploadBoxOpen=!0},$scope.progress=function(up,file){$scope[progress]=file.percent},$scope.uploaderSuccess=function(up,file,info){file.url&&($scope[imgURL]=file.url,$scope.$apply()),file.result="上传成功！",modal.toast.success("上传成功！")},$scope.uploaderError=function(up,err,errTip){modal.toast.error("error",null,errTip)}}]);