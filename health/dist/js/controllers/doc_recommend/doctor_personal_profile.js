app.controller("DoctorPersonalProfileCtrl",function($scope,utils,$http,$modal,toaster,$location,$state,$rootScope,$stateParams){function getData(){$http.post(app.url.doctor.getRecommentDoc,{access_token:app.url.access_token,recommendId:$stateParams.id}).success(function(data,status,headers,config){1==data.resultCode?data.data&&($scope.isShow=1==data.data.isShow,$scope.umeditor.replaceHtml(data.data.content)):toaster.pop("error",null,data.resultMsg)}).error(function(data,status,headers,config){toaster.pop("error",null,data.resultMsg)})}$scope.isSaved=!1,$scope.isShow=!1,$scope.name=$stateParams.name,getData(),$scope.qiniuFilters={mime_types:[{title:"Image files",extensions:"jpg,gif,png"}]},$scope.selectFile=function(){$scope.upload()},$scope.token=app.url.access_token,$scope.uploaderAdded=function(up,files){$scope.uploadPercent=0},$scope.uploaderSuccess=function(up,file,info){$scope.fontImgUrl=file.url,$scope.copy_small=file.url+"?imageView2/3/w/200/h/200",$scope.uploadPercent=100,toaster.pop("success",null,"封面修改成功！")},$scope.uploaderError=function(up,err,errTip){err.code==-600?toaster.pop("error",null,"文件过大"):toaster.pop("error",null,errTip)},$scope.fileUploadProcess=function(up,file){$scope.uploadPercent=100==file.percent?99:file.percent},$scope.config={file:{urlParams:"?imageView2/3/w/800/h/800"}},$scope.save=function(){if($scope.content.length<=0)return void toaster.pop("warn","","请填写正文");$scope.isSaved=!0;var isShow=1==$scope.isShow?1:2;$http.post(app.url.doctor.updateRecDocument,{access_token:app.url.access_token,recommendDoctId:$stateParams.id,doctorName:$stateParams.name,content:$scope.content,isShow:isShow}).success(function(data,status,headers,config){1==data.resultCode?(toaster.pop("success","","保存成功,3秒钟后返回"),setTimeout(function(){$state.go("app.docRecommend.list",{},{reload:!0})},3e3)):($scope.isSaved=!1,toaster.pop("error","",data.resultMsg))}).error(function(data,status,headers,config){$scope.isSaved=!1,toaster.pop("error","",data.resultMsg)})},$scope.toPreview=function(){if($scope.content.length<=0)return void toaster.pop("warn","","请填写正文");var articlePreview={content:$scope.content,isShow:$scope.isShow};$modal.open({templateUrl:"previewModalContent.html",controller:"previewModalInstanceCtrl",windowClass:"docPreModal",resolve:{article:function(){return articlePreview}}})}}),app.controller("previewModalInstanceCtrl",function($scope,$modalInstance,article,$sce){$scope.article=article,$scope.article.content=$sce.trustAsHtml($scope.article.content),$scope.cancel=function(){$modalInstance.dismiss("cancel")}});