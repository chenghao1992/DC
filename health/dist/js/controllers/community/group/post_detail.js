app.controller("groupPostDetailCtrl",function($scope,utils,$http,$modal,$modalInstance,toaster,postDetailId){function getPostDetail(){$http.post(app.url.community.findByTopicDetail,{access_token:app.url.access_token,groupId:app.url.groupId,id:postId}).success(function(data,status,headers,config){1==data.resultCode?$scope.postDetail=data.data:toaster.pop("error","",data.resultMsg)}).error(function(data,status,headers,config){toaster.pop("error","","服务器繁忙，请稍后再试！")})}function getPostReply(index){index?index-=1:(index=0,$scope.pageIndex=1),$http.post(app.url.community.findByReplyList,{access_token:app.url.access_token,groupId:app.url.groupId,topicId:postId,pageIndex:index,pageSize:$scope.page_size}).success(function(data,status,headers,config){var getData=data.data;1==data.resultCode?($scope.replyList=getData.pageData,$scope.page_count=getData.pageCount,$scope.replyTotal=getData.total):toaster.pop("error","",data.resultMsg)}).error(function(data,status,headers,config){toaster.pop("error","","服务器繁忙，请稍后再试！")})}var postId=postDetailId;$scope.page_size=10,$scope.pageIndex=1,getPostDetail(),getPostReply(),$scope.pageSizeChange=function(){$scope.pageIndex=1,getPostReply()},$scope.pageChanged=function(){getPostReply($scope.pageIndex)},$scope.deletePostReply=function(replyId){var modalInstance=$modal.open({templateUrl:"delReplyModal.html",controller:"delPostReplyModalCtrl",size:"sm"});modalInstance.result.then(function(status){"ok"==status&&$http.post(app.url.community.deleteReplyId,{access_token:app.url.access_token,id:replyId}).success(function(data,status,headers,config){1==data.resultCode?(toaster.pop("success",null,"删除评论成功！"),getPostReply()):toaster.pop("error","",data.resultMsg)}).error(function(data,status,headers,config){toaster.pop("error","","服务器繁忙，请稍后再试！")})})},$scope.deletePost=function(postId){var modalInstance=$modal.open({templateUrl:"delPostModal.html",controller:"delPostModalCtrl",size:"sm"});modalInstance.result.then(function(status){"ok"==status&&$http.post(app.url.community.deleteTopic,{access_token:app.url.access_token,id:postId}).success(function(data,status,headers,config){1==data.resultCode?(toaster.pop("success",null,"删除帖子成功！"),$modalInstance.close("ok")):toaster.pop("error","",data.resultMsg)}).error(function(data,status,headers,config){toaster.pop("error","","服务器繁忙，请稍后再试！")})})},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}),app.controller("delPostReplyModalCtrl",function($scope,$modalInstance,toaster,$http,utils){$scope.ok=function(){$modalInstance.close("ok")},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}),app.controller("delPostModalCtrl",function($scope,$modalInstance,toaster,$http,utils){$scope.ok=function(){$modalInstance.close("ok")},$scope.cancel=function(){$modalInstance.dismiss("cancel")}});