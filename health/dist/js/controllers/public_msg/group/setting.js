app.controller("MsgSettingCtrl",function($scope,$timeout,utils,$http,$modal,Upload,toaster,$state,$stateParams,$rootScope){$scope.allowUpload=!0;var getPubInfo=function(){$http.post(app.url.pubMsg.getPubInfo,{access_token:app.url.access_token,pid:$stateParams.id}).success(function(data,status,headers,config){1==data.resultCode?$scope.pubInfo=data.data:toaster.pop("error","",data.resultMsg)}).error(function(data,status,headers,config){toaster.pop("error","",data.resultMsg)})};getPubInfo(),$scope.qiniuFilters={mime_types:[{title:"Image files",extensions:"jpg,gif,png"}]},$scope.selectFile=function(){$scope.upload()},$scope.token=app.url.access_token,$scope.uploaderAdded=function(up,files){$scope.uploadPercent=0,console.log(up,files)},$scope.uploaderSuccess=function(up,file,info){$scope.pubInfo.photourl=file.url,$scope.uploadPercent=100,toaster.pop("success",null,"封面修改成功！")},$scope.uploaderError=function(up,err,errTip){err.code==-600?toaster.pop("error",null,"文件过大"):toaster.pop("error",null,errTip)},$scope.fileUploadProcess=function(up,file){$scope.uploadPercent=100==file.percent?99:file.percent},$scope.save=function(){$http.post(app.url.pubMsg.savePubInfo,{access_token:app.url.access_token,pid:$stateParams.id,photourl:$scope.pubInfo.photourl,note:$scope.pubInfo.note}).success(function(data,status,hueaders,config){1==data.resultCode?toaster.pop("success","","保存成功"):toaster.pop("error","",data.resultMsg)}).error(function(data,status,headers,config){toaster.pop("error","",data.resultMsg)})}});