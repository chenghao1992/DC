"use strict";app.controller("AdminCtrl",["$rootScope","$scope","$modal","$log","$http","toaster",function($rootScope,$scope,$modal,$log,$http,toaster){$scope.adminstrators=null;var access_token=localStorage.getItem("access_token"),enterprise_doc_id=localStorage.getItem("enterprise_id"),enterprise_id=JSON.parse(localStorage.getItem("company")).id;$http.post(app.url.yiliao.searchByCompanyUser,{access_token:access_token,objectId:enterprise_id,status:"C",pageIndex:0,pageSize:200}).success(function(data,status,headers,config){1==data.resultCode?$scope.adminstrators=data.data.pageData:console.log(data.data.resultMsg)}).error(function(data,status,headers,config){console.log(data)}),$scope.isCreator=function(adminstrator){return adminstrator.doctor.doctorId==enterprise_doc_id},$scope.removeRow=function(row){var removeModal=$modal.open({templateUrl:"removeModalContent.html",controller:"removeModalInstanceCtrl",size:"sm",resolve:{item:function(){return row}}});removeModal.result.then(function(status){if("ok"==status){var index=$scope.adminstrators.indexOf(row);index!==-1&&$scope.adminstrators.splice(index,1)}},function(){})},$scope.invite=function(){var inviteModal=$modal.open({templateUrl:"inviteDocToManageModalContent.html",controller:"inviteDocToManageModalCtrl"});inviteModal.result.then(function(status){"ok"==status&&console.log("invite")},function(){})}}]),app.controller("removeModalInstanceCtrl",["$scope","$modalInstance","item","$http","toaster",function($scope,$modalInstance,item,$http,toaster){var access_token=localStorage.getItem("access_token");localStorage.getItem("enterprise_id"),JSON.parse(localStorage.getItem("company")).id;$scope.ok=function(){$http.post(app.url.yiliao.deleteByCompanyUser,{access_token:access_token,ids:item.id}).success(function(data,status,headers,config){1==data.resultCode?toaster.pop("success","","删除成功"):toaster.pop("error","","删除失败")}).error(function(data,status,headers,config){toaster.pop("error","","删除失败")}),$modalInstance.close("ok")},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),app.controller("inviteDocToManageModalCtrl",["$scope","$modalInstance","$http",function($scope,$modalInstance,$http){var access_token=localStorage.getItem("access_token"),enterprise_id=(localStorage.getItem("enterprise_id"),JSON.parse(localStorage.getItem("company")).id);$("#dialog_container");$scope.viewData={},$scope.formData={},$scope.showResult=!1,$scope.showNoneResult=!1,$scope.showMsgBox=!1,$scope.showSuccess=!1,$scope.showInviteAgain=!1,$scope.showWarn=!1;var doIt=function(){var ttl,dpt,hsp,keys=$scope.formData.doctorInfo,type="?",dt=null;return keys?(11!==keys.length||/\D/.test(keys)||"1"!==keys.charAt(0)?(type="",dt={access_token:access_token,keyWord:keys}):(type="",dt={access_token:access_token,keyWord:keys},$scope.formData.phone=keys),void $http({url:app.url.doctor.searchs,method:"post",data:dt}).then(function(resp){console.log(resp);var dt=resp.data.data[0];dt&&dt.doctor?($scope.showNoneResult=!1,$scope.showInviteAgain=!1,$scope.showResult=!0,ttl=dt.doctor.title||"--",dpt=dt.doctor.departments||"--",hsp=dt.doctor.hospital||"--",$scope.formData.id=dt._id,$scope.viewData.name=dt.name||"--",$scope.viewData.telephone=dt.telephone,$scope.viewData.info=ttl+" / "+dpt+" / "+hsp,$scope.viewData.imgSrc=dt.headPicFileName||"src/img/a0.jpg"):($scope.showResult=!1,$scope.showInviteAgain=!1,$scope.showNoneResult=!0,$scope.viewData.keys=keys)},function(x){console.error(x.statusText)})):void console.warn("无效查询！")};$scope.inviteManageEnt=function(){$http({url:app.url.yiliao.addCompanyUser,method:"post",data:{access_token:access_token,objectId:enterprise_id,doctorId:$scope.formData.id,telephone:$scope.viewData.telephone}}).then(function(resp){1===resp.data.resultCode?2==resp.data.data.status?($scope.showResult=!1,$scope.showWarn=!1,$scope.showInviteAgain=!0,$scope.formData.inviteAgain_text=resp.data.data.msg):($scope.showResult=!1,$scope.success_text=resp.data.data.msg,$scope.showSuccess=!0):($scope.showResult=!1,$scope.showWarn=!0,$scope.showInviteAgain=!1,$scope.formData.warn_text=resp.data.resultMsg,console.log("[邀请失败！] "+resp.data.resultMsg))},function(x){console.error(x.statusText)})},$scope.inviteAgain=function(){$http({url:app.url.yiliao.addCompanyUser,method:"post",data:{access_token:access_token,objectId:enterprise_id,doctorId:$scope.formData.id,telephone:$scope.viewData.telephone,againInvite:1}}).then(function(resp){1===resp.data.resultCode?($scope.showResult=!1,$scope.success_text=resp.data.data.msg,$scope.showSuccess=!0,$scope.showInviteAgain=!1):($scope.showResult=!1,$scope.showWarn=!0,$scope.showInviteAgain=!1,$scope.formData.warn_text=resp.data.resultMsg,console.log("[邀请失败！] "+resp.data.resultMsg))},function(x){console.error(x.statusText)})},$scope.sendMsg=function(){$scope.showNoneResult=!1,$scope.showMsgBox=!0,$scope.showInviteAgain=!1},$scope.doSend=function(){$http({url:app.url.yiliao.addCompanyUser,method:"post",data:{access_token:access_token,objectId:enterprise_id,telephone:$scope.formData.phone}}).then(function(resp){1===resp.data.resultCode?($scope.showResult=!1,$scope.showSuccess=!0,$scope.showInviteAgain=!1):($scope.showResult=!1,$scope.showWarn=!0,$scope.showInviteAgain=!1,$scope.formData.warn_text=resp.data.resultMsg,console.log("[邀请失败！] "+resp.data.resultMsg))},function(x){console.error(x.statusText)})},$scope.query=function(){$scope.showMsgBox=!1,$scope.showSuccess=!1,$scope.showWarn=!1,$scope.showInviteAgain=!1,doIt()},$scope.close=function(){$modalInstance.dismiss("cancel")}}]);