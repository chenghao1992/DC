"use strict";app.controller("FollowUpTableCtrl",function($rootScope,$scope,$state,$http,$compile,utils,$modal,toaster){function setTable(info){function dataTable(data){datable&&datable.fnClearTable(),datable=$("#planListDatable").dataTable({language:app.lang.datatables.translation,ordering:!1,searching:!1,bDestroy:!0,lengthMenu:[10,15,20,30,40,50,100],data:data,columns:[{data:null,title:"编号",createdCell:function(nTd,sData,oData,iRow,iCol){var startnum=this.api().page()*this.api().page.info().length;$(nTd).html(iRow+1+startnum)}},{data:"name"},{data:null,defaultContent:"<button class='btn btn-xs btn-primary text-xs view'>详情</button>  <button class='btn btn-xs btn-danger text-xs del'>删除</button>"}],createdRow:function(nRow,aData,iDataIndex){$(nRow).on("click","button.view",function(){$state.go("app.new_follow_up",{planId:aData.id})}),$(nRow).on("click","button.del",function(){$http.post(app.url.care.deleteFollowUpTemplate,{access_token:app.url.access_token,tmplateId:aData.id}).then(function(rpn){1===rpn.data.resultCode?(toaster.pop("error",null,"删除成功"),setTable(info)):toaster.pop("error",null,rpn.data.resultMsg)})})}})}console.log(info.id),$scope.diseaseNameSelected=info.name,$http.post(app.yiliao+"pack/followReForm/findFollowUpTemplates",{access_token:app.url.access_token,groupId:app.url.groupId(),categoryId:info.id}).then(function(rpn){1===rpn.data.resultCode?dataTable(rpn.data.data):toaster.pop("error",null,rpn.data.resultMsg)})}var contacts=new Tree("sch_cnt_list",{hasCheck:!1,allCheck:!1,multiple:!1,allHaveArr:!1,self:!0,search:!1,arrType:[1,0],data:{url:app.yiliao+"group/stat/getDiseaseTypeTree",param:{access_token:app.url.access_token,groupId:app.url.groupId(),tmpType:2}},datakey:{id:"id",name:"name",sub:"children"},info:{name:"name",id:"id",pid:"department",leaf:"leaf"},root:{selectable:!0,name:"全部",id:null},events:{click:setTable},callback:function(){var dts=contacts.tree.find("dt");setTable(dts.eq(0).data().info)}}),datable=null;setTable({}),$scope.addFollow=function(data){$state.go("app.new_follow_up")}}),app.controller("viewPopCtrl",function($rootScope,$scope,$modalInstance,$state,$http,utils,toaster){function setTree(argument){function setTable(info){function dataTable(data){datable&&datable.fnClearTable(),datable=$("#listDatable").dataTable({language:app.lang.datatables.translation,ordering:!1,searching:!1,bDestroy:!0,lengthMenu:[10,15,20,30,40,50,100],bLengthChange:!1,data:data,columns:[{data:null,title:"编号",createdCell:function(nTd,sData,oData,iRow,iCol){var startnum=this.api().page()*this.api().page.info().length;$(nTd).html(iRow+1+startnum)}},{data:"ghnrContent"},{data:null,defaultContent:"<button class='btn btn-primary text-xs btn-xs'>添加</button>"}],createdRow:function(nRow,aData,iDataIndex){$(nRow).on("click","button",function(){addFollow(aData)})}})}function addFollow(data){console.log(data),$http.post(app.yiliao+"pack/care/saveCareTemplateByCare",{access_token:app.url.access_token,categoryId:info.id,type:2,groupId:app.url.groupId(),careName:data.ghnrContent,cares:[data.ghnrId]}).then(function(rpn){console.log(rpn.data),1===rpn.data.resultCode?toaster.pop("success",null,"添加成功"):toaster.pop("error",null,rpn.data.resultMsg)})}if($scope.diseaseNameSelected=info.name,info.leaf)return info.id?void $http.post(app.yiliao+"pack/care/queryCareTemplateItem",{access_token:app.url.access_token,categoryId:info.id,type:5}).then(function(rpn){console.log(rpn.data),1===rpn.data.resultCode?dataTable(rpn.data.data):toaster.pop("error",null,rpn.data.resultMsg)}):toaster.pop("error",null,"缺少参数：病种ID")}var contacts=new Tree("sch_list",{hasCheck:!1,arrType:[0,0],data:{url:app.yiliao+"base/getDiseaseTree"},datakey:{id:"id",name:"name",sub:"children"},info:{name:"name",id:"id",pid:"department",leaf:"leaf"},events:{click:setTable},callback:function(){for(var dts=contacts.tree.find("dt"),i=0;i<dts.length;i++)if(dts.eq(i).data().info.leaf)return void setTable(dts.eq(i).data().info)}}),datable=null;setTable({})}$scope.viewName="添加随访";var care_plan_disease=null;$scope.add=function(){care_plan_disease?($rootScope.care_plan_depots&&($rootScope.care_plan_depots={depot1:[],depot2:[],depot3:[],depot4:[]}),$rootScope.care_plan_disease=care_plan_disease,$modalInstance.dismiss("cancel")):toaster.pop("error",null,"请选择正确的病种")},setTimeout(setTree,0),$scope.cancel=function(){$state.go("app.follow_up_table",{planId:Math.round(9e3*Math.random())}),$modalInstance.dismiss("cancel")}}),app.controller("ifonPopCtrl",function($rootScope,$scope,$modalInstance,$sce,$state,$http,utils,toaster,viewData){$scope.setHtml=function(str){str=str.replace(/\([^\)]*\)/g," ( <input class='text-base' type='text' placeholder='答案' > ) ");var reg=new RegExp("\n","g");return str=str.replace(reg,"</br>"),$sce.trustAsHtml(str)},$scope.viewData=viewData,console.log($scope.viewData),$scope.cancel=function(){$modalInstance.dismiss("cancel")},$scope["delete"]=function(){console.log(viewData.templateId),$http.post(app.yiliao+"pack/care/deleteCareTempateByCare",{access_token:app.url.access_token,templateId:viewData.templateId}).then(function(rpn){1===rpn.data.resultCode?($modalInstance.dismiss("cancel"),$state.go("app.follow_up_table",{planId:Math.round(9e3*Math.random())}),toaster.pop("success",null,"删除成功")):toaster.pop("error",null,rpn.data.resultMsg)})}}),app.controller("FollowUpLibraryCtrl",function($scope,$state,$http,toaster){function treeClick(info){$scope.diseaseName=info.name,setTable(info.id)}function setTable(diseaseTypeId,pageIndex,pageSize){$http.post(app.urlRoot+"designer/getFollowPlans",{access_token:app.url.access_token,groupId:app.url.groupId(),diseaseTypeId:diseaseTypeId||$scope.diseaseTypeId||"",pageIndex:pageIndex-1||$scope.pageIndex-1||0,pageSize:pageSize||$scope.pageSize||10}).then(function(rpn){rpn=rpn.data,1===rpn.resultCode?($scope.planList=rpn.data.pageData,$scope.page_count=Math.ceil(rpn.data.total/$scope.pageSize)):rpn.resultMsg?toaster.pop("error",null,rpn.resultMsg):toaster.pop("error",null,"接口出错")})}var contacts=new Tree("CarePlanLibraryTree",{hasCheck:!1,allCheck:!1,multiple:!1,allHaveArr:!1,self:!0,search:!1,arrType:[1,0],data:{url:app.yiliao+"group/stat/getDiseaseTypeTree4Follow",param:{access_token:app.url.access_token,groupId:app.url.groupId()}},datakey:{id:"id",name:"name",sub:"children"},info:{name:"name",id:"id",pid:"department",leaf:"leaf"},root:{selectable:!0,name:"全部",id:null},events:{click:treeClick},callback:function(){var dts=contacts.tree.find("dt");treeClick(dts.eq(0).data().info)}});$scope.diseaseTypeId="",$scope.diseaseName="",$scope.pageIndex=1,$scope.pageSize=10,$scope.setTable=setTable,$scope.pageChanged=function(){setTable()},$scope.enable=function(planId,status){$http.post(app.yiliao+"designer/enable",{access_token:app.url.access_token,carePlanId:planId,status:status}).then(function(rpn){if(rpn=rpn.data,1===rpn.resultCode){var tip="成功禁用";1==status&&(tip="成功启用"),toaster.pop("success",null,tip),setTable()}else rpn.resultMsg?toaster.pop("error",null,rpn.resultMsg):toaster.pop("error",null,"接口出错")})}});