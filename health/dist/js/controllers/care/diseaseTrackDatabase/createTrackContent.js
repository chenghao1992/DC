app.controller("createTrackContentCtrl",function($scope,$sce,$http,toaster,$state,$modal){var item="",diseaseTypeId=item.diseaseTypeId||"";$scope.diseaseName=item.diseaseTypeName||"",console.log(item.diseaseTypeId);var UpadeId="";item.item?($scope.illnessTrack=item.item,UpadeId=item.item.id):$scope.illnessTrack={name:"题目名称",options:[{seq:"1",name:"选项名称",level:"1",appendQuestions:[]},{seq:"2",name:"选项名称",level:"1",appendQuestions:[]}]},$scope.chooseDepartment=function(){console.log("df");var modalInstance=$modal.open({templateUrl:"chooseIllnessModalContent.html",controller:"chooseIllnessModalCtrl",size:"md"});modalInstance.result.then(function(result){result.isTrue&&(diseaseTypeId=result.id,$scope.diseaseName=result.diseaseName)})},$scope.addOption=function(){$scope.illnessTrack.options.push({seq:$scope.illnessTrack.options[$scope.illnessTrack.options.length-1].seq+1,name:"选项名称",level:"1",appendQuestions:[]})},$scope.removeItem=function(item,arry){var index=arry.indexOf(item);arry.splice(index,1)},$scope.addAppendQuestion=function(option){option.appendQuestions||(option.appendQuestions=[]),option.appendQuestions.push({name:"追加题目名称",options:[{name:"选项名称"},{name:"选项名称"}]})},$scope.addAppendOption=function(question){question.options.push({name:"选项名称"})},$scope.copyAppendQuestion=function(question,questions){var index=questions.indexOf(question);questions.splice(index+1,0,{name:question.name,options:function(){return angular.copy(question.options)}()})},$scope.optionChange=function(option,arry){var index=arry.indexOf(option.levelName);option.level=index+1},$scope.exchangeItem=function(moveItem,replaceItem,arry){var mIndex=arry.indexOf(moveItem),rIndex=arry.indexOf(replaceItem);arry.splice(rIndex,1,moveItem),arry.splice(mIndex,1,replaceItem)},$scope.selectFile=function(){$scope.upload()},$scope.token=app.url.access_token,$scope.uploaderAdded=function(up,files){$scope.uploadPercent=0},$scope.uploaderSuccess=function(up,file,info){$scope.fontImgUrl=file.url,$scope.copy_small=file.url+"?imageView2/3/w/200/h/200",$scope.uploadPercent=100,toaster.pop("success",null,"封面修改成功！")},$scope.uploaderError=function(up,err,errTip){toaster.pop("error",null,"题图大于2M，请重新上传"),"-600"==err.code?toaster.pop("error",null,"题图大于2M，请重新上传"):toaster.pop("error",null,errTip)},$scope.ok=function(){var json={name:$scope.illnessTrack.name,options:$scope.illnessTrack.options},param={};return param=UpadeId?{questionId:UpadeId,access_token:app.url.access_token,groupId:app.url.groupId(),diseaseType:diseaseTypeId,jsonData:JSON.stringify(json)}:{access_token:app.url.access_token,groupId:app.url.groupId(),diseaseType:diseaseTypeId,jsonData:JSON.stringify(json)},diseaseTypeId?void $http.post(app.urlRoot+"designer/storeQuestion",param).then(function(rpn){rpn=rpn.data,rpn&&1==rpn.resultCode?(UpadeId?toaster.pop("success",null,"修改成功"):toaster.pop("success",null,"新建成功"),$modalInstance.close(!0)):rpn&&rpn.resultMsg?toaster.pop("error",null,rpn.resultMsg):(toaster.pop("error",null,"新建错误"),console.error(rpn))}):void toaster.pop("waring",null,"请先选择科室")},$scope.cancel=function(){$modalInstance.dismiss("cancel")}});