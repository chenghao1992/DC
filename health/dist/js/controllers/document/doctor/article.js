app.controller("DoctorArticleCtrl",function($scope,$timeout,utils,$http,$modal,toaster,$location,$state,$rootScope,$stateParams,$sce){function getArticleData(){$http.post(app.url.document.getArticleByIdWeb,{access_token:app.url.access_token,articleId:$stateParams.id,createType:$stateParams.createType}).success(function(data,status,headers,config){1==data.resultCode?data.data?($scope.article={id:data.data.id,url:$sce.trustAsResourceUrl(data.data.url+"?v="+Date.now())},2==data.data.collect&&($scope.showEdit=!0,$scope.showDel=!0),0==data.data.collect&&($scope.showCollect=!0),1==data.data.collect&&($scope.showRCollect=!0)):$scope.articleNoFound=!0:console.log(data.resultMsg)}).error(function(data,status,headers,config){alert(data.resultMsg)})}$scope.showEdit=!1,$scope.showDel=!1,$scope.showCollect=!1,$scope.showRCollect=!1,$scope.articleNoFound=!1;var curGroupId=localStorage.getItem("curGroupId"),userId=localStorage.getItem("user_id"),getArticleParam={access_token:app.url.access_token,articleId:$stateParams.id,createType:$stateParams.createType};6==$stateParams.id&&(getArticleParam.createrId=curGroupId),getArticleData(),$scope.deleteArticle=function(){var modalInstance=$modal.open({templateUrl:"delModalContent.html",controller:"delModalInstanceCtrl",size:"sm"});modalInstance.result.then(function(status){"ok"==status&&$http.post(app.url.document.delArticle,{access_token:app.url.access_token,articleId:$stateParams.id}).success(function(data,status,headers,config){1==data.resultCode?(window.opener.reflashData(),window.close()):console.log(data.resultMsg)}).error(function(data,status,headers,config){alert(data.resultMsg)})},function(){})},$scope.collectArticle=function(){$http.post(app.url.document.collectArticle,{access_token:app.url.access_token,articleId:$stateParams.id,createType:3,createrId:userId}).success(function(data,status,headers,config){1==data.resultCode?"false"==data.data?(toaster.pop("success","","收藏失败"),$scope.showCollect=!0,$scope.showRCollect=!1):"true"==data.data&&(window.opener.reflashData(),toaster.pop("success","","收藏成功"),$scope.showCollect=!1,$scope.showRCollect=!0):console.log(data.resultMsg)}).error(function(data,status,headers,config){console.log(data.resultMsg)})},$scope.removeCollect=function(){$http.post(app.url.document.collectArticleRemove,{access_token:app.url.access_token,articleId:$stateParams.id,createType:3}).success(function(data,status,headers,config){1==data.resultCode?(window.opener.reflashData(),toaster.pop("success","","取消收藏成功"),$scope.showCollect=!0,$scope.showRCollect=!1):console.log(data.resultMsg)}).error(function(data,status,headers,config){alert(data.resultMsg)})},$scope.editArticle=function(){$state.go("doctor_edit_article",{id:$scope.article.id,createType:$stateParams.createType},{reload:!0})}}),app.controller("delModalInstanceCtrl",function($scope,$modalInstance,toaster,$http,utils){$scope.ok=function(){$modalInstance.close("ok")},$scope.cancel=function(){$modalInstance.dismiss("cancel")}});