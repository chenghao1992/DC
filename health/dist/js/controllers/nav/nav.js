app.controller("navCtrl",["$rootScope","$scope","$http","utils","$state","Group","toaster","AppFactory",function($rootScope,$scope,$http,utils,$state,Group,toaster,AppFactory){var groupId=$scope.groupId||utils.localData("curGroupId");"true"===utils.localData("has_more_group")?$scope.has_more_group=!0:$scope.has_more_group=!1,"1"===utils.localData("userStatus")?$scope.userStatus=!0:$scope.userStatus=!1,$scope.user={},$scope.isBlocked=!1,$scope.showIt=!0,$rootScope.showGroupKnowledge=!0,Group.handle(groupId,function(group){if($scope.currentOrgInfo=group,$scope.currentOrgInfo&&AppFactory.group.isServiceGroup($scope.currentOrgInfo.id).then(function(_data){_data?$scope.isServiceGroup=!0:$scope.isServiceGroup=!1}),"S"===group.isBlocked?$scope.isBlocked=!0:$scope.isBlocked=!1,$scope.isBlocked&&$rootScope.roleX?"3"===group.user.status&&$state.go("app.group_in_blocked_status"):"/group_in_blocked_status"==$state.current.url&&($rootScope.roleX?"3"===group.user.status&&"P"===group.status.applyStatus&&$state.go("app.contacts",null,{reload:!1}):$state.go("app.invite_list",null,{reload:!1})),!group.name)return $scope.un_reg=!0,$scope.un_check=!1,$rootScope.un_check=!1,$scope.user.isInGroup=!1,$scope.user.isAdmin=!1,$scope.isSysAdmin=!1,$rootScope.isSysAdmin=!1,$rootScope.isActive=!1,void($scope.datas.user_headPicFile=utils.localData("headPicFile")||"src/img/a0.jpg");switch(group.user.headPic?$scope.datas.user_headPicFile=group.user.headPic:$scope.datas.user_headPicFile="src/img/a0.jpg",group.user.status){case"1":$scope.user.isInGroup=!1,$scope.user.isAdmin=!1,$rootScope.isSysAdmin=!1;break;case"2":$scope.user.isInGroup=!0,$scope.user.isAdmin=!1,$rootScope.isSysAdmin=!1;break;case"3":$scope.user.isAdmin=!0,$scope.user.isInGroup=!0,$rootScope.isSysAdmin=!0;utils.localData("userStatus")}switch($scope.isBlocked&&($rootScope.showGroupKnowledge=!1),$rootScope.roleX||($scope.user.isInGroup=!0,$scope.user.isAdmin=!1,$rootScope.isSysAdmin=!0,$scope.showIt=!0),group.status.active){case"active":$rootScope.isActive=!0,group.status.applyStatus="P";break;case"inactive":$rootScope.isActive=!1,void 0===group.status.applyStatus&&(group.status.applyStatus="P");break;default:$rootScope.isActive=!0}switch(group.status.applyStatus){case"P":$scope.un_reg=!1,$scope.un_check=!1,$rootScope.un_check=!1,$scope.pass=!0,$scope.step_apply=!0,$scope.step_check=!0,$scope.step_active=!0,$scope.step_status=!0;break;case"NP":$scope.un_reg=!1,$scope.un_check=!1,$rootScope.un_check=!1,$scope.step_apply=!0,$scope.step_check=!0,$scope.step_active=!1,$scope.no_pass=!0,$scope.step_status=!1;break;case"A":$scope.un_reg=!1,$scope.un_check=!0,$rootScope.un_check=!0,$scope.step_apply=!0,$scope.step_check=!0,$scope.step_active=!1,$scope.step_status=!0;break;default:$scope.un_reg=!0,$rootScope.un_check=!1,$scope.step_apply=!0,$scope.step_check=!0,$scope.step_active=!1,$scope.step_status=!0}$scope.datas.groupPicFile=group.logo}),$http({url:app.url.yiliao.hasCreateRole,method:"post",data:{access_token:app.url.access_token,doctorId:utils.localData("user_id")}}).then(function(resp){"1"==resp.data.resultCode&&(resp.data.data===!0?$rootScope.canCreateGroup=!0:$rootScope.canCreateGroup=!1)}),$scope.group={},$scope.user.name=$scope.datas.user_name||utils.localData("user_name"),$rootScope.roleX=$rootScope.roleX||"true"===utils.localData("roleX"),$scope.user.userId=$scope.datas.user_id||utils.localData("user_id"),$scope.group.isIdentified===!0||"true"===$scope.group.isIdentified?$scope.group.isIdentified=!0:$scope.group.isIdentified=!1,setTimeout(function(){for(var nav_li=$(".nav > li > .nav-item"),i=0;i<nav_li.length;i++)nav_li.eq(i).attr("id","id_"+i);$("#"+utils.localData("curLiId")).addClass("nav-cur-item").parent().parent().parent().addClass("active"),nav_li.click(function(){nav_li.removeClass("nav-cur-item"),$(this).addClass("nav-cur-item"),utils.localData("curLiId",$(this).attr("id"))}),$http({url:app.url.yiliao.searchDoctor,method:"post",data:{access_token:app.url.access_token,groupId:groupId,status:"J"}}).then(function(resp){1===resp.data.resultCode&&resp.data.data&&(resp.data.data.total>0?$rootScope.hasUncheckedMumber=!0:$rootScope.hasUncheckedMumber=!1)},function(x){console.error(x.statusText)})},200)}]);