app.controller("GroupH5Ctrl",function($scope,$timeout,utils,$http,$modal,Upload,toaster,$state,$stateParams,$sce){function getData(){$http.post(app.url.yiliao.getGroupDescInfoById,{access_token:app.url.access_token,groupId:localStorage.getItem("curGroupId")}).success(function(data,status,headers,config){1==data.resultCode?($scope.fontImgUrl=data.data.copyPath,$scope.formData.isShowImg=1==data.data.isShowImg,$scope.umeditor.replaceHtml(data.data.content)):toaster.pop("error",null,data.resultMsg)}).error(function(data,status,headers,config){toaster.pop("error",null,data.resultMsg)})}$scope.formData={},$scope.fontImg=null,$scope.fontImgUrl=null,$scope.isSaved=!1,$scope.formData.isShowImg=!1,getData(),$scope.config={file:{urlParams:"?imageView2/3/w/800/h/800"}},$scope.qiniuFilters={mime_types:[{title:"Image files",extensions:"jpg,gif,png"}]},$scope.selectFile=function(){$scope.upload()},$scope.token=app.url.access_token,$scope.uploaderAdded=function(up,files){$scope.uploadPercent=0},$scope.uploaderSuccess=function(up,file,info){$scope.fontImgUrl=file.url,$scope.copy_small=file.url+"?imageView2/3/w/200/h/200",$scope.uploadPercent=100,toaster.pop("success",null,"展示图修改成功！")},$scope.uploaderError=function(up,err,errTip){$timeout(err.code==-600?function(){toaster.pop("error",null,"文件大小超过2M，无法上传")}:function(){toaster.pop("error",null,errTip)})},$scope.fileUploadProcess=function(up,file){$scope.uploadPercent=100==file.percent?99:file.percent},$scope.saveDoc=function(){if(!$scope.fontImgUrl)return void toaster.pop("warn","","请上传展示图");if($scope.formData.content.length<=0)return void toaster.pop("warn","","请填写正文");$scope.isSaved=!0;var isShowImg=1==$scope.formData.isShowImg?1:2;$http.post(app.url.yiliao.createDocument,{access_token:app.url.access_token,documentType:5,copyPath:$scope.fontImgUrl,isShowImg:isShowImg,content:$scope.formData.content,groupId:localStorage.getItem("curGroupId")}).success(function(data,status,headers,config){1==data.resultCode?(toaster.pop("success","","保存成功,3秒钟后返回集团设置"),setTimeout(function(){$state.go("app.setting.group_edit",{},{reload:!0})},3e3)):($scope.isSaved=!1,toaster.pop("error","",data.resultMsg))}).error(function(data,status,headers,config){$scope.isSaved=!1,toaster.pop("error","",data.resultMsg)})},$scope.toPreview=function(){if(!$scope.fontImgUrl)return void toaster.pop("warn","","请上传展示图");if($scope.formData.content.length<=0)return void toaster.pop("warn","","请填写正文");var articlePreview={copyPath:$scope.fontImgUrl,content:$scope.formData.content,isShow:$scope.formData.isShowImg};$modal.open({templateUrl:"previewModalContent.html",controller:"previewModalInstanceCtrl",windowClass:"docPreModal",resolve:{article:function(){return articlePreview}}})},$scope.umerrorcallback=function(value){$timeout(function(){console.log(toaster),toaster.pop("error","",value)},0)}}),app.controller("previewModalInstanceCtrl",function($scope,$modalInstance,article,$sce){$scope.article=article,$scope.article.content=$sce.trustAsHtml($scope.article.content),$scope.cancel=function(){$modalInstance.dismiss("cancel")}});