"use strict";app.controller("ContactsSearch",["$rootScope","$scope","$state","$timeout","$http","utils","Doctor","$stateParams",function($rootScope,$scope,$state,$timeout,$http,utils,Doctor,$stateParams){function initTable(){var index=1,start=0,length=1*utils.localData("page_length")||10,setTable=function(){doctorList=$("#searchList"),dTable=doctorList.dataTable({draw:index,displayStart:start,lengthMenu:[5,10,15,20,30,40,50,100],pageLength:length,bServerSide:!0,sAjaxSource:url,fnServerData:function(sSource,aoData,fnCallback){param&&(param.pageIndex=index-1,param.pageSize=aoData[4].value,param.access_token=app.url.access_token,$http({method:"post",url:sSource,data:param}).then(function(resp){resp=resp.data.data;for(var i=0;i<resp.pageData.length;i++)utils.extendHash(resp.pageData[i],["doctor","contactWay","remarks","departmentFullName","applyStatusName","inviterName","updatorDate"]),utils.extendHash(resp.pageData[i].doctor,["name","departments","position","doctorNum","skill","introduction","telephone"]);resp.start=resp.start,resp.recordsTotal=resp.total,resp.recordsFiltered=resp.total,resp.length=resp.pageSize,resp.data=resp.pageData,fnCallback(resp),$scope.loading=!1,$rootScope.loaded=!0}))},searching:!1,language:app.lang.datatables.translation,createdRow:function(nRow,aData,iDataIndex){var a_link=$(nRow).find(".a-link");a_link.click(function(){$scope.seeDetails(aData.doctorId)})},columns:[{orderable:!1,render:function(set,status,dt){if(dt.doctor&&dt.doctor.headPicFilePath)var path=dt.doctor.headPicFilePath;else var path="src/img/a0.jpg";return'<img class="a-link" src="'+path+'"/>'}},{data:"doctor.name",orderable:!1,searchable:!1,render:function(set,status,dt){return'<a class="a-link">'+dt.doctor.name+"</a>"}},{data:"departmentFullName",orderable:!1,searchable:!1},{data:"doctor.position",orderable:!1,searchable:!1},{data:"doctor.telephone",orderable:!1,searchable:!1},{data:"contactWay",orderable:!1,searchable:!1},{data:"applyStatus",orderable:!1,searchable:!1,render:function(set,status,dt){return"1"==set?"已通过":"2"==set?"待审核":"3"==set?"未通过":"7"==set?"未认证":""}},{data:"inviterName",orderable:!1,searchable:!1},{data:"updatorDate",orderable:!1,searchable:!1,render:function(set,status,dt){return set?utils.dateFormat(set,"yyyy年MM月dd日"):""}},{data:"status",orderable:!1,searchable:!1,render:function(set,status,dt){return"C"==set?"集团成员":"I"==set?"已邀请,待验证":"J"==set?"已申请,待审核":"S"==set?"已解除":""}}]}),dTable.off().on("init.dt",function(){doctorList.find("tr[data-id="+$rootScope.curRowId+"]").addClass("currentRow")}).on("length.dt",function(e,settings,len){index=1,start=0,length=len,dTable.fnDestroy(),setTable(),utils.localData("page_length",len)}).on("page.dt",function(e,settings){index=settings._iDisplayStart/length+1,start=length*(index-1),dTable.fnDestroy(),utils.localData("page_index",index),utils.localData("page_start",start),setTable()})};setTable()}var url=app.url.yiliao.getDoctors,groupId=utils.localData("curGroupId");if($rootScope.isSearching){var param={};url=app.url.yiliao.searchDoctor,param.groupId=groupId,param.keyword=$rootScope.keyword}$scope.seeDetails=function(id){id&&($("#doctor_details").removeClass("hide"),$rootScope.winVisable=!0,Doctor.addData(id))};var doctorList,dTable;initTable()}]);